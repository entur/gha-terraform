name: Entur/Terraform/CI
on:
  push:
  workflow_dispatch:

jobs:
  test-lint-ok:
    uses: ./.github/workflows/lint.yml
    with:
      tf_directory: fixture/terraform

  test-terraform-plan:
    uses: ./.github/workflows/plan.yml
    with:
      tf_directory: fixture/terraform
    secrets: inherit

  test-terraform-apply:
    uses: ./.github/workflows/apply.yml
    needs: test-terraform-plan
    with:
      terraform_dir: fixture/terraform
    secrets: inherit